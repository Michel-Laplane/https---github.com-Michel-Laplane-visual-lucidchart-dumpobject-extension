"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.LucidSpreadsheetIntegrationRegistry = void 0;
const checks_1 = require("../checks");
const lucidspreadsheetintegration_1 = require("./lucidspreadsheetintegration");
/** @ignore until spreadsheet integration is ready for launch (CHART-51946) */
class LucidSpreadsheetIntegrationRegistry {
    static nextHookName() {
        return '__lucidspreadsheet__hook' + this.nextHookId++;
    }
    /**
     * Register a spreadsheet integration.
     */
    static addSpreadsheetIntegration(client, spreadsheetIntegration) {
        let configChooserActions;
        const configChooser = spreadsheetIntegration.configChooser;
        if (configChooser instanceof lucidspreadsheetintegration_1.CustomDetailsChooser) {
            const actionName = LucidSpreadsheetIntegrationRegistry.nextHookName();
            configChooserActions = actionName;
            client.registerAction(actionName, async () => {
                try {
                    return await configChooser.getConfig();
                }
                catch (error) { }
                return lucidspreadsheetintegration_1.LucidSpreadsheetIntegrationFailureType.GenericFailure;
            });
        }
        else {
            const actionName = LucidSpreadsheetIntegrationRegistry.nextHookName();
            configChooserActions = { 'l': actionName };
            client.registerAction(actionName, async () => {
                try {
                    const result = await configChooser.getList();
                    if ((0, checks_1.isString)(result)) {
                        return result;
                    }
                    return {
                        'h': result.header,
                        'r': result.rows.map(({ icon, id, values }) => ({ 'i': icon, 'd': id, 'l': values })),
                    };
                }
                catch (error) { }
                return lucidspreadsheetintegration_1.LucidSpreadsheetIntegrationFailureType.GenericFailure;
            });
        }
        const getMultipleSheetsForSpreadsheetDetailsActionName = LucidSpreadsheetIntegrationRegistry.nextHookName();
        client.registerAction(getMultipleSheetsForSpreadsheetDetailsActionName, async (message) => {
            try {
                const result = await spreadsheetIntegration.getMultipleSheetsForSpreadsheetDetails(message['spreadsheetDetails']);
                if ((0, lucidspreadsheetintegration_1.lucidSpreadsheetIntegrationFailureTypeValidator)(result)) {
                    return result;
                }
                else {
                    // Serialize the Map
                    return Array.from(result);
                }
            }
            catch (error) { }
            return lucidspreadsheetintegration_1.LucidSpreadsheetIntegrationFailureType.GenericFailure;
        });
        const serialized = {
            'ld': spreadsheetIntegration.labelDescription,
            'li': spreadsheetIntegration.labelIconUrl,
            'dc': spreadsheetIntegration.dataConnectorName,
            'c': spreadsheetIntegration.addCardsIntegration,
            'gs': configChooserActions,
            'gm': getMultipleSheetsForSpreadsheetDetailsActionName,
        };
        client.sendCommand("asi" /* CommandName.AddSpreadsheetIntegration */, serialized);
    }
}
exports.LucidSpreadsheetIntegrationRegistry = LucidSpreadsheetIntegrationRegistry;
LucidSpreadsheetIntegrationRegistry.nextHookId = 0;
